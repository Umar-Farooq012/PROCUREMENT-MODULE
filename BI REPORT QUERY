WITH Actual_Product AS (
    SELECT
        SUM(SPR.PROFIT_LOSS) AS TOTAL_PROFIT_LOSS_BENIFIT
        -- SUM(NET_AMOUNT - NVL(SPR.MARKET_RATE, 0) * NVL(NO_BAGS, 0)) AS TOTAL_PROFIT_LOSS
    FROM
        AB_ITEMS_MASTER IM
    JOIN
        AB_SETUP_POLICY_REGISTERED SPR ON SPR.ITEM_ID = IM.ITEM_ID
    WHERE
        SPR.POLICY_TYPE = 'ACTUAL PRODUCT'
        AND SPR.POLICY_IDS = :GV_DEAL_ID
),
Club_Product AS (
    SELECT
        SUM(SPR.PROFIT_LOSS) AS TOTAL_PROFIT_LOSS_BENIFIT
        -- SUM(NET_AMOUNT - NVL(SPR.MARKET_RATE, 0) * NVL(NO_BAGS, 0)) AS TOTAL_PROFIT_LOSS
    FROM
        AB_ITEMS_MASTER IM
    JOIN
        AB_SETUP_POLICY_REGISTERED SPR ON SPR.ITEM_ID = IM.ITEM_ID
    WHERE
        SPR.POLICY_TYPE = 'CLUB PRODUCT'
        AND SPR.POLICY_IDS = :GV_DEAL_ID
),
Benefit_Product AS (
    SELECT
        SUM(SPR.PER_BAG_VALUE) AS TOTAL_AMOUNT
    FROM
        AB_SETUP_POLICY_REGISTERED SPR 
    WHERE
        SPR.POLICY_TYPE = 'BENEFIT PRODUCT'
        AND SPR.POLICY_IDS = :GV_DEAL_ID
)
SELECT 
    AP.TOTAL_PROFIT_LOSS_BENIFIT +
    CP.TOTAL_PROFIT_LOSS_BENIFIT +
    BP.TOTAL_AMOUNT AS TOTAL_SUM
FROM 
    Actual_Product AP,
    Club_Product CP,
    Benefit_Product BP;
