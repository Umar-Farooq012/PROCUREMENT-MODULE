SELECT
       PO.PURCHASING_TYPE,
       PO.COMPANY_ORDER_NO,
       MAX(CASE WHEN REG.REG_TYPE = 'COMPANY' AND REG.SR_ID = PO.COMPANY_ID THEN REG.REG_NAME END) AS COMPANY_NAME,
       TO_CHAR(PO.TRANSACTION_DATE, 'DD-MON-YYYY') AS TRANSACTION_DATE,
       NVL(MAX(CASE WHEN REG.REG_TYPE = 'SUPPLIER' AND REG.SR_ID = PO.VENDOR_ID THEN REG.PARTY_NAME END), 'N/A') AS VENDOR_NAME,
       MAX(CASE WHEN REG.REG_TYPE = 'AGENCY' AND REG.SR_ID = PO.AGENCY_ID THEN REG.REG_NAME END) AS AGENCY_NAME,
        MAX(CASE WHEN LOOKUP_ID = '013' THEN  LD.LOOKUP_DET_NAME END) AS LOADING_TYPE
FROM AB_PO_DEMAND_REQ_DET DRD
JOIN AB_ITEMS_MASTER ITM ON ITM.ITEM_ID = DRD.ITEM_ID
LEFT JOIN AB_PO_PURCHASE_ORDER_DET POR ON POR.DEMAND_DET_ID = DRD.DET_ID
LEFT JOIN AB_PO_PURCHASE_ORDER PO ON PO.PO_ID = POR.PO_ID
LEFT JOIN AB_LOOKUP_DETAIL LD ON LD.DET_ID IN (PO.LOADING_TYPE_ID, PO.FREIGHT_TYPE_ID, PO.PAYMENT_MODE_ID, PO.TRANSACTION_TYPE_ID)
LEFT JOIN AB_SETUP_REGISTRATION REG ON REG.SR_ID IN (PO.COMPANY_ID, PO.SALE_POINT_ID, PO.VENDOR_ID, PO.AGENCY_ID, PO.BANK_NAME_ID)
WHERE PO.PO_ID = :P54_PO_ID
and LD.LOOKUP_ID IN('013')
GROUP BY
       PO.PURCHASING_TYPE,
       PO.COMPANY_ORDER_NO,
       PO.TRANSACTION_DATE
HAVING COUNT(DISTINCT DRD.ITEM_ID) >= 1




-- SELECT
--        -- PO.PO_ID,

--        PO.PURCHASING_TYPE,
--        PO.COMPANY_ORDER_NO,
--        MAX(CASE WHEN REG.REG_TYPE = 'COMPANY' AND REG.SR_ID = PO.COMPANY_ID THEN REG.REG_NAME END) AS COMPANY_NAME,
--       TO_CHAR(po.TRANSACTION_DATE,'DD-MON-YYYY') TRANSACTION_DATE,


--        NVL(MAX(CASE WHEN REG.REG_TYPE = 'SUPPLIER' AND REG.SR_ID = PO.VENDOR_ID THEN REG.PARTY_NAME END),'GG') AS VENDOR_NAME,
       
--        MAX(CASE WHEN REG.REG_TYPE = 'AGENCY' AND REG.SR_ID = PO.AGENCY_ID THEN REG.REG_NAME END) AS AGENCY_NAME,
--            MAX(CASE WHEN LOOKUP_ID = '013' THEN  LD.LOOKUP_DET_NAME END) AS LOADING_TYPE
--           -- PO.PO_ID
--            --POR.DET_ID
--          -- MAX(CASE WHEN LOOKUP_ID = '010' THEN  LD.LOOKUP_DET_NAME END) AS FREIGHT_TYPE
--       --LD.LOOKUP_DET_NAME FREIGHT_TYPE,
--        --POR.DEMAND_DET_ID,
--       -- ITM.ITEM_ID,
      
--       -- 
--        --ITM.UNIT,
--       -- ITM.PACKING,
--            -- CASE WHEN POR.DEMAND_ORDER_STATUS = 'R' THEN POR.CHANGE_BAGS ELSE DRD.NO_BAGS END AS NO_BAGS,
--     --   CASE WHEN POR.DEMAND_ORDER_STATUS = 'R' THEN POR.CHANGE_TONS ELSE DRD.NO_TONS END AS NO_TONS,
 
--        --ITM.PACKING_SIZE,
--        -- ITM.ITEM_NAME
--       -- POR.DEMAND_ORDER_STATUS,
--       -- CASE WHEN POR.DEMAND_ORDER_STATUS = 'R' THEN NULL ELSE POR.CHANGE_TONS END AS CHANGE_TONS,
--        --CASE WHEN POR.DEMAND_ORDER_STATUS = 'R' THEN NULL ELSE POR.CHANGE_BAGS END AS CHANGE_BAGS,
--     --    POR.RATE,
--     --    POR.NET_AMOUNT,
--     --    POR.REMARKS,
--     --     DRD.NO_TONS AS TONS
--   FROM AB_PO_DEMAND_REQ_DET DRD 
--   JOIN AB_ITEMS_MASTER ITM ON ITM.ITEM_ID = DRD.ITEM_ID
--   LEFT JOIN AB_PO_PURCHASE_ORDER_DET POR ON POR.DEMAND_DET_ID = DRD.DET_ID
--   LEFT JOIN AB_PO_PURCHASE_ORDER PO ON PO.PO_ID = POR.PO_ID 
--   LEFT JOIN AB_LOOKUP_DETAIL LD ON LD.DET_ID IN (PO.LOADING_TYPE_ID, PO.FREIGHT_TYPE_ID, PO.PAYMENT_MODE_ID, PO.TRANSACTION_TYPE_ID)
--   LEFT JOIN AB_SETUP_REGISTRATION REG ON REG.SR_ID IN (PO.COMPANY_ID, PO.SALE_POINT_ID, PO.VENDOR_ID, PO.AGENCY_ID, PO.BANK_NAME_ID)
--  WHERE PO.PO_ID =:P54_PO_ID
--  and LD.LOOKUP_ID IN('013')
--   --AND LD.LOOKUP_ID = '010'
  
  



-- GROUP BY 
--   --PO.PO_ID,
--  PO.PURCHASING_TYPE,
--        --POR.DET_ID,
--      --  POR.PO_ID,
 
--        PO.COMPANY_ORDER_NO,
--         po.TRANSACTION_DATE,
--       --LD.LOOKUP_DET_NAME,
--        POR.DEMAND_DET_ID,
--      --  ITM.ITEM_ID,
--        ITM.ITEM_NAME,
--        ITM.PACKING_SIZE,
--        ITM.UNIT,
--        ITM.PACKING,
--        POR.DEMAND_ORDER_STATUS,
--        POR.CHANGE_TONS,
--        POR.CHANGE_BAGS,
--        DRD.NO_TONS,
--        DRD.NO_BAGS,
--        POR.RATE,
--        POR.NET_AMOUNT,
--        POR.REMARKS
